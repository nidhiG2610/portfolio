(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"3Jgm":function(e,t,o){"use strict";var n=o("mrSG"),i=o("IbG+"),s=o("pjml"),r=o("Qbdf"),a=o("k9iv"),c=o("0JpG"),u=o("TnpK"),l=o("Sa5G"),d=o("FBBZ"),p=o("EVdn");var h=o("Q/M7");o.d(t,"a",function(){return f}),o.d(t,"b",function(){return m});var f="ultra.components.services.partner",m="partner",v=function(){function e(e,t,o,n,i,s,r,a,c,u,l,d){this.$q=e,this.$rootScope=t,this.$stateParams=o,this.$window=n,this.cacheFactory=i,this.contextCourse=s,this.errorModalService=r,this.localizeService=a,this.ultraStateService=c,this.PartnerCourseModel=u,this.PartnerModel=l,this.PartnerStatusModel=d,this.shortMaxAge=5e3,this.partnerStatusCache=i.createCache("PartnerStatusCache",{deleteOnExpire:"passive",maxAge:this.shortMaxAge}),this.partnersCache=i.createCache("PartnersCache",{deleteOnExpire:"passive",maxAge:this.shortMaxAge}),this.partnerLinkedCoursesCache=i.createCache("PartnerLinkedCoursesCache",{deleteOnExpire:"passive",maxAge:this.shortMaxAge})}return e.prototype.getPartnerCloudStatus=function(e,t){if(void 0===t&&(t=!1),p("body").hasClass("bb-within-uia-test"))return this.$q.when({enabled:!1,userCloudProvisioned:!1});if(t)return this.PartnerStatusModel.getStatus(e);var o=this.partnerStatusCache.get("status");return o||(o={promise:this.PartnerStatusModel.getStatus(e)},this.partnerStatusCache.put("status",o)),o.promise},e.prototype.resetPartnerCloudStatus=function(){this.partnerStatusCache.removeAll()},e.prototype.getPartners=function(e,t){if(void 0===t&&(t=!1),t)return this.PartnerModel.getPartnersByType(e);var o=this.partnersCache.get(e);return o||(o={promise:this.PartnerModel.getPartnersByType(e)},this.partnersCache.put(e,o)),o.promise},e.prototype.getLinkedPartners=function(e,t){if(void 0===t&&(t=!1),t)return this.PartnerCourseModel.$new(e).partnerLinkedCourses.$search().$allow(["400-599"]).$asPromise();var o=this.partnerLinkedCoursesCache.get(e);return o||(o={promise:this.PartnerCourseModel.$new(e).partnerLinkedCourses.$search().$allow(["400-599"]).$asPromise()},this.partnerLinkedCoursesCache.put(e,o)),o.promise},e.prototype.launchPartner=function(e,t){e.toolProvider.available?d.p(e)?this._launchBrowseLink(e.browseContentLink):this._checkProvisioningAndLaunch(e,t):e.toolProvider.compatible?this.errorModalService.handleError(this.localizeService.translateSync({locale:this.localizeService.getLocale(this.$rootScope),key:"course.partnerList.errorProviderNotConfigured"})):this.errorModalService.handleError(this.localizeService.translateSync({locale:this.localizeService.getLocale(this.$rootScope),key:"course.partnerList.errorProviderIncompatible"}))},e.prototype._checkProvisioningAndLaunch=function(e,t){var o=this;this._getProvisioningCheckResult(e.providerId,t).then(function(t){var n;t.status?(n={partnerId:e.providerId,toolType:"browse",partnerTitle:d.i(e)},l.x.Inline.isEqualTo(o.$stateParams.mode)?n.mode=o.$stateParams.mode:(n.partnerParentId=o.$stateParams.parentId,n.position=o.$stateParams.position)):(n={partnerId:e.providerId,toolType:"partnerProvisioning",partnerTitle:o.localizeService.translateSync({locale:o.localizeService.getLocale(o.$rootScope),key:"course.partnerList.partnerProvisioning"}),partnerParentId:o.$stateParams.parentId},o.ultraStateService.current.name.indexOf("peek.books-and-tools")>=0&&(n.returnState="base.courses.peek.course.outline.peek.books-and-tools")),o.ultraStateService.goPeekState("partner-tool.tool",n)})},e.prototype._getProvisioningCheckResult=function(e,t){return i.isDefined(t)?this.$q.when({status:t}):this.PartnerCourseModel.$new(this.contextCourse.courseId).updateProvisioning(e)},e.prototype._launchBrowseLink=function(e){var t=h.c(e.url);switch(this.$stateParams.parentId&&(t=h.a(t,"content_id",this.$stateParams.parentId)),e.target){case"_self":this._windowLocationAssign(t);break;case"_blank":this.$window.open(t)}},e.prototype._windowLocationAssign=function(e){this.$window.location.assign(e)},e.$inject=["$q","$rootScope","$stateParams","$window","DSCacheFactory",r.e,a.c,c.serviceName,u.d,s.X.serviceName,s.V.serviceName,s.Z.serviceName],e}();!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n.__extends(t,e)}(v);i.module(f,[r.b,a.b,c.moduleName,u.b,s.R]).service(m,v)},HjsN:function(e,t,o){"use strict";o.d(t,"a",function(){return r}),o.d(t,"b",function(){return c});var n=o("mrSG"),i=(o("wnWX"),o("dCrD")),s=o("Oyr+"),r="allCloudUploadsCompleteEvent",a="failed",c=function(e){function t(t,o,n){var i=e.call(this,t,o,n)||this;return i.cloudUploadPromises=[],i.onFilesSelectedHandler=function(e){var t=[];e.forEach(function(e){var o={id:e.id,deferred:i.$q.defer()};t.push(o.deferred),i.cloudUploadPromises.push(o)}),i.$q.all(t.map(function(e){return e.promise})).then(function(){i.scope.$emit(r)},function(e){i.scope.$emit(r,e)})},i.resolveFileUploadDeferred=function(e,t){var o=i.cloudUploadPromises.findIndex(function(t){return t.id===e});return o>=0&&(t?i.cloudUploadPromises[o].deferred.reject(t):i.cloudUploadPromises[o].deferred.resolve(),i.cloudUploadPromises.splice(o,1),!0)},i.cloudUploadAttachHandler=function(e,t,o,n){var s=i.scope.attachHandler||i.defaultAttachHandler,r=i.$q.defer();return s(e,t,o,n).then(function(){i.resolveFileUploadDeferred(t.ui.fileId)&&r.resolve()}),r.promise},o.$on(s.e,function(e,t,o,n,r){n===s.c.Error?i.resolveFileUploadDeferred(t,a):n===s.c.Cancel&&i.resolveFileUploadDeferred(t)}),i}return n.__extends(t,e),t.$inject=["$injector","scope","element"],t}(i.a)},RPq7:function(e,t,o){"use strict";o.d(t,"b",function(){return c}),o.d(t,"a",function(){return u});var n=o("mrSG"),i=o("IbG+"),s=o("oSB+"),r=o.n(s),a=o("lEL+"),c="ultra.directives.contentItemMouseover",u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.Top=new t("TOP"),t.Bottom=new t("BOTTOM"),t.Default=new t("DEFAULT"),t}(r.a),l=function(){function e(e,t,o){var n=this;this.scope=e,this.element=t,this.timeout=o,this.lastPosition=u.Default,this.lastTime=0,t.mouseover(function(){n.recalculatePosition()}),t.mousemove(function(e){Date.now()-n.lastTime>1e3?(n.timeout.cancel(n.lastMousemoveTimeout),n.handleMousemove(e)):(n.timeout.cancel(n.lastMousemoveTimeout),n.lastMousemoveTimeout=n.timeout(function(){n.handleMousemove(e)},n.scope,100,!1))}),t.mouseleave(function(){n.timeout.cancel(n.lastMousemoveTimeout),n.lastPosition=u.Default}),e.$on("content-outline-hover-end",function(){n.timeout.cancel(n.lastMousemoveTimeout),n.lastPosition=u.Default})}return e.prototype.handleMousemove=function(e){null!=this.elementOffset&&null!=this.elementHeight||this.recalculatePosition(),this.lastTime=Date.now(),e.pageY-this.elementOffset>this.elementHeight/2?(this.lastPosition.isEqualTo(u.Bottom)||this.broadcastPosition(u.Bottom),this.lastPosition=u.Bottom):(this.lastPosition.isEqualTo(u.Top)||this.broadcastPosition(u.Top),this.lastPosition=u.Top)},e.prototype.broadcastPosition=function(e){this.scope.$emit("content-item-mouseover",{element:this.element,relativeMousePosition:e})},e.prototype.recalculatePosition=function(){this.elementHeight=this.element.outerHeight(),this.elementOffset=this.element.offset().top},e.$inject=["scope","element",a.b],e}(),d=function(){function e(e){var t=this;this.$injector=e,this.restrict="A",this.scope={canCreate:"&"},this.link=function(e,o){e.canCreate&&e.canCreate()&&(e.contentItemMouseover=t.$injector.instantiate(l,{scope:e,element:o}))}}return e.$inject=["$injector"],e}();i.module(c,[a.a]).directive("bbContentItemMouseover",["$injector",function(e){return e.instantiate(d)}])},dCrD:function(e,t,o){"use strict";o.d(t,"a",function(){return S});var n=o("mrSG"),i=o("oSB+"),s=o.n(i),r=o("Oyr+"),a=o("0JpG"),c=o("RPq7"),u=o("Qbdf"),l=o("nYZ0"),d=o("Vsv2"),p=o("A+IJ"),h=o("+4Px"),f=o("pjml"),m=o("3Jgm"),v=o("e6jQ"),b=o("lEL+"),w=o("TnpK"),C=o("mQPS"),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.Unzip=new t("Unzip"),t.Website=new t("Website"),t.Default=new t("Default"),t}(s.a),S=function(){function e(e,t,o){var n=this;this.scope=t,this.element=o,this.alwaysShow=!1,this.isMenuVisible=!1,this.isButtonVisible=!1,this.isMobile=!1,this.isUploadMultipleFiles=!1,this.removeDefaultRenderClass=!1,this.uuid=Object(v.b)(),this.downloadFile=function(e){n.scope.$broadcast("downloadFile",e)},this.defaultAttachHandler=function(e,t,o,i){var s=i||n.$q.defer(),r={parentId:void 0,positionBefore:"start",positionAfter:void 0,depth:0};return n.isUploadMultipleFiles=o,n.insertLocation=n.getInsertLocationData(),r=t.ui&&t.ui.parentId?{parentId:t.ui.parentId,positionBefore:t.ui.positionBefore,positionAfter:t.ui.positionAfter,depth:t.ui.depth}:n.insertLocation,"folder"===t.type?(n.closeMenu(),!t.ui||t.ui.depth<=p.l?n._addFolderToCourseOutline(t,r).then(function(e){t.ui={parentId:e.id,positionBefore:"start",depth:1+Number(e.depth)},s.resolve(t)},function(e){s.reject(e)}):s.resolve()):n._addContentToCourseOutline(t,e,r).then(function(e){n.scope.$root.$broadcast("uploadComplete",t),e.$save().$then(function(o){t.ui&&t.ui.needUnzip&&(e=o),s.resolve()})}),s.promise},this.toggleAddContentMenu=function(){n.isMenuVisible=!n.isMenuVisible,n.timeout(function(){n.scope.$apply()},n.scope)},this.hideAddContentMenu=function(e){null===e.target.closest("#"+n.getButtonWrapperId())&&(n.isMenuVisible=!1,n.timeout(function(){n.scope.$apply()},n.scope))},this.$q=e.get("$q"),this.$rootScope=e.get("$rootScope"),this.bbLocalize=e.get(a.serviceName),this.cloudDriveService=e.get(d.c),this.timeout=e.get(b.b),this.contentSvc=e.get(l.d),this.CourseModel=e.get(f.o.serviceName),this.PartnerService=e.get(m.b),this.ultraState=e.get(w.d),this.contextCourse=e.get(u.e),this.scope.addMenuId=v.a(),this.showMenuOverride=this.scope.showMenuOverride,this.alwaysShow=this.scope.alwaysShow,this.currentCourse=this.contextCourse.course,this.isMobile=!this.cloudDriveService.isShowOneDrive,this.isCloudServiceAvailablePromise=this.cloudDriveService.isCloudServiceAvailable(d.a.KLOUDLESS).then(function(e){return n.isCloudServiceAvailable=e}),this.bbLocalize.loadBundle("components/directives/add-content-button").then(function(){var e="content";n.scope.itemIndex&&null!=n.scope.itemIndex()?e="item-index":"discussions"===n.scope.contextArea?e="discussion":"grades"===n.scope.contextArea?e="grades":"course-group"===n.scope.contextArea?e="group":"bbml-editor-single-file"===n.scope.contextArea&&(n.scope.addContentButton.isMenuVisible=!0),n.addButtonAriaLabel=n.bbLocalize.translateSync({locale:n.bbLocalize.getLocale(n.scope),key:"components.directives.add-content-button.aria-label."+e+".add-button-label"});var t="components.directives.add-content-button.aria-label.content."+(n.isMobile?"yourDevice":"yourComputer");if(n.uploadAriaLabel=n.bbLocalize.translateSync({locale:n.bbLocalize.getLocale(n.scope),key:t}),n.scope.itemName||n.scope.itemType){n.scope.$watchGroup(["itemName()","itemType()","itemIndex()"],function(t){var o=t[0],i=t[1],s=t[2];if(o||i){var r=i?i+"-":"",a=n.scope.positionAfter?"after":"before";n.addButtonAriaLabel=n.bbLocalize.translateSync({locale:n.bbLocalize.getLocale(n.scope),key:"components.directives.add-content-button.aria-label."+e+".add-button-label-item-name-"+r+a,params:{itemName:o,itemIndex:s},noWrap:!0,noEscape:!0})}})}}),o.mouseover(function(){n.$rootScope.$broadcast("mouseover-add-content-button"),n.scope.$apply(function(){n.scope.addContentButton.showButton()})}),this.scope.$on("close-all-add-menus",function(){n.showMenuOverride||(n.scope.addContentButton.isMenuVisible=!1)}),this.scope.showBothButtons&&this.scope.showBothButtons()||this.scope.$on("mouseover-add-content-button",function(){n.scope.addContentButton.hideButton()}),this.scope.$on("content-item-hover",function(e,t){n.scope.addContentButton.hideButton();var i=function(){var e;return(e=o.closest(".folder-contents").find("bb-add-content-button").first().is(o)?o.closest(".folder-contents").find(".js-content-div .element-list-row").first():o.closest(".js-content-div").next(".js-content-div").find(".element-list-row").first()).hasClass("element-list-row")||(e=o.next().find(".js-content-div").first().find(".element-list-row")),!!e.is(t.element)&&n.scope.addContentButton.showButton()},s=function(){var e=!1;o.closest(".js-content-div").find(".element-list-row").first().is(t.element)&&(e=!0),o.closest(".folder").is(t.element.parent(".folder"))&&(e=!1),t.element.hasClass("js-parent")&&t.element.hasClass("open")&&(e=!1),n.scope.addContentButton.isButtonVisible!==e&&(n.scope.addContentButton.isButtonVisible=e)};n.scope.showBothButtons&&n.scope.showBothButtons()?i()||s():t.relativeMousePosition.isEqualTo(c.a.Top)?i():s()}),this.scope.$on("content-outline-hover-end",function(){n.scope.addContentButton.hideButton()}),this.scope.$watch("alwaysShow",function(e){n.alwaysShow=e}),o.on("drop",function(e){n.closeMenu(),n.scope.$emit(r.e,n.scope.parentId(),n.scope.positionBefore&&n.scope.positionBefore(),n.scope.positionAfter&&n.scope.positionAfter(),n.scope.depth(),void 0,n.scope.content,r.c.AssignDropTarget)}),this.scope.$on("$stateChangeStart",function(){n.ultraState.includes("**.content-manage.import.**")?n.isMenuVisible=n.isEmptyFolder():n.isMenuVisible=!1,n.timeout(function(){n.scope.$apply()},n.scope)}),this.scope.$on(r.b,function(){n.closeMenu()}),this.isMenuVisible=this.scope.showMenuOverride,null!=this.scope.showMenuOverride&&this.scope.$watch(function(){return n.scope.showMenuOverride},function(e){n.scope.addContentButton.isMenuVisible=e,n.showMenuOverride=e}),this.getInsertLocationData()}return e.prototype.onKeydown=function(e){e.keyCode===h.g&&this.isMenuVisible&&(this.closeMenu(),this.element.find("a.js-show-add-options").focus(),e.stopPropagation(),e.preventDefault())},e.prototype.showButton=function(){this.isButtonVisible=!0},e.prototype.hideButton=function(){this.isButtonVisible=!1},e.prototype.turnOffAlwaysShow=function(){this.alwaysShow=!1},e.prototype.toggleMenu=function(){var e=this;if(!this.showMenuOverride){var t=this.isMenuVisible;t||this.$rootScope.$broadcast("close-all-add-menus"),this.isMenuVisible||this.timeout(function(){e.element.scrollintoview({duration:250})},this.scope,0,!1),this.isMenuVisible=!t}},e.prototype.isForceShowAddButton=function(){return this.scope.forceShowAddButton},e.prototype.closeMenu=function(){this.isMenuVisible&&this.toggleMenu()},e.prototype.getInsertLocationData=function(){return this.insertLocation={parentId:this.scope.parentId(),positionBefore:this.scope.positionBefore&&this.scope.positionBefore(),positionAfter:this.scope.positionAfter&&this.scope.positionAfter(),depth:this.scope.depth(),contentId:"create"}},e.prototype.assignPosition=function(){this.closeMenu(),this.scope.$emit("bb-bbml-editor-assign-position",this.getInsertLocationData())},e.prototype._addFolderToCourseOutline=function(e,t){var o=this;return this.contentSvc.makeContentInContentTree(this.scope.rootContent&&this.scope.rootContent(),this.contextCourse.courseId,t.parentId,t.positionBefore,t.positionAfter,!0).then(function(n){var i=n.content;return i.parentId=t.parentId,i.positionBefore=t.positionBefore,i.positionAfter=t.positionAfter,i.isAvailable=!1,i.depth=t.depth,i.description="",i.title=e.name,i.contentDetail={"resource/x-bb-folder":{isFolder:!0}},i.courseId=o.contextCourse.courseId,i.contentHandler=f.r.ContentHandler.Folder,i.$save().$asPromise()})},e.prototype._addContentToCourseOutline=function(e,t,o){var n=this;return this.contentSvc.makeContentInContentTree(this.scope.rootContent&&this.scope.rootContent(),this.contextCourse.courseId,o.parentId,o.positionBefore,o.positionAfter,!0).then(function(e){return e.content}).then(function(i){return i.parentId=o.parentId,i.positionBefore=o.positionBefore,i.positionAfter=o.positionAfter,i.isAvailable=!1,i.depth=o.depth,i.description="",i.title=t.fileName,i.contentHandler=f.r.ContentHandler.File,i.contentDetail={"resource/x-bb-file":{file:{fileName:t.fileName,fileLocation:t.fileLocation}}},e.ui&&e.ui.needUnzip&&(i.contentDetail["resource/x-bb-file"].action=g.Unzip.toString()),i.courseId=n.contextCourse.courseId,i.$asPromise()})},e.prototype.getTargetId=function(){return"addContentButton-"+this.uuid},e.prototype.getButtonWrapperId=function(){return"addContentButtonWrapper-"+this.uuid},e.prototype.getDirectionalHint=function(){return C.DirectionalHint.bottomCenter},e.prototype.isEmptyFolder=function(){var e=this.scope,t=e.content,o=e.folderNestedButton;return!!(t&&t.isFolder()&&t.children&&0===t.children.length&&o&&o())},e}()},mQPS:function(e,t,o){e.exports=o("ZJ/X")(98)},pG4O:function(e,t,o){var n=o("4BeY"),i=o("IaFt"),s=new n({id:"icon-small-arrow-down",use:"icon-small-arrow-down-usage",viewBox:"0 0 16 16",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="icon-small-arrow-down"><path d="M1 4l7 7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});i.add(s);e.exports=s},wnWX:function(e,t,o){}}]);